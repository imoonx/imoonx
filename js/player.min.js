var vol,rem=[];function prevMusic(){playList(rem.musicId-1)}function playMusic(){rem.paused=!1,$(".btn-play").addClass("btn-state-paused")}function pauseMusic(){rem.paused=!0,$(".btn-play").removeClass("btn-state-paused")}function nextMusic(){playList(rem.musicId+1)}function audioErr(){nextMusic()}function updateProgress(){if(!1!==rem.paused)return!0;scrollLyric(rem.audio[0].currentTime)}function quietMusic(mute){$(mute).is(".btn-quite-mute")?$(mute).removeClass("btn-quite-mute"):$(mute).addClass("btn-quite-mute")}function initAudio(){rem.audio=$("<audio autoplay></audio>").appendTo("body"),rem.isNeedVolume&&(rem.audio[0].volume=volume_bar.percent),rem.audio[0].addEventListener("timeupdate",updateProgress),rem.audio[0].addEventListener("play",playMusic),rem.audio[0].addEventListener("pause",pauseMusic),$(rem.audio[0]).on("ended",nextMusic),rem.audio[0].addEventListener("error",audioErr)}function initListHeader(){rem.musicList.append('<div class="list-head">    <span class="music-name">        歌曲    </span>    <span class="auth-name">        歌手    </span></div>')}function initMusicList(){for(var i=0;i<musicList[0].item.length;i++){addItem(musicList[0].item[i])}}function addItem(music){var html='<div class="list-item">    <span class="list-num">'+music.id+'</span>    <span class="music-name" id="music-name">'+music.name+'</span>    <span class="auth-name" id="auth-name">'+music.artist+"</span></div>";rem.musicList.append(html)}function play(music){if("err"==music.url)return audioErr(),!1;try{ajaxLyric(music.lryic,lyricCallback),rem.audio[0].pause(),rem.audio.attr("src",music.url),rem.audio[0].play(),document.title=music.name}catch(e){return void audioErr()}rem.isNeedVolume&&(rem.errCount=0,music_bar.goto(0),music_bar.lock(!1)),changeCover(music)}function playByUrl(url){if("err"==url)return!1;try{rem.audio[0].pause(),rem.audio.attr("src",url),rem.audio[0].play()}catch(e){return}}function pause(){void 0!==rem.paused?!1===rem.paused?rem.audio[0].pause():rem.audio[0].play():playList(rem.musicId)}function playList(id){if(musicList[0].item.length<=0)return!0;id>=musicList[0].item.length&&(id=0),id<0&&(id=musicList[0].item.length-1),rem.musicId=id,play(musicList[0].item[id])}function initWeChat(){document.addEventListener("WeixinJSBridgeReady",musicInWeixinHandler)}function musicInWeixinHandler(){rem.audio[0].play(),document.removeEventListener("WeixinJSBridgeReady",musicInWeixinHandler)}var isMobile={Android:function(){return!!navigator.userAgent.match(/Android/i)},BlackBerry:function(){return!!navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return!!navigator.userAgent.match(/iPhone|iPad|iPod/i)},Windows:function(){return!!navigator.userAgent.match(/IEMobile/i)},any:function(){return isMobile.Android()||isMobile.BlackBerry()||isMobile.iOS()||isMobile.Windows()}};function ajaxLyric(lyricUrl,callback){void 0===lyricUrl&&callback(""),$.ajax({type:"GET",url:lyricUrl,dataType:"text",success:function(jsonData){callback(jsonData||"")},error:function(XMLHttpRequest,textStatus,errorThrown){callback("")}})}function lyricCallback(str){if(rem.lyric=parseLyric(str),""===rem.lyric)return!1;$(".music-info").html(""),$(".music-info").scrollTop(0),rem.lastLyric=-1;var i=0;for(var k in rem.lyric){var txt=rem.lyric[k];txt||(txt="&nbsp;");var li=$("<li data-no='"+i+"' class='lrc-item'>"+txt+"</li>");$(".music-info").append(li),i++}}function parseLyric(lrc){if(""===lrc)return"";for(var lyrics=lrc.split("\n"),lrcObj={},i=0;i<lyrics.length;i++){var lyric=decodeURIComponent(lyrics[i]),timeReg=/\[\d*:\d*((\.|\:)\d*)*\]/g,timeRegExpArr=lyric.match(timeReg);if(timeRegExpArr)for(var clause=lyric.replace(timeReg,""),k=0,h=timeRegExpArr.length;k<h;k++){var t=timeRegExpArr[k];lrcObj[60*Number(String(t.match(/\[\d*/i)).slice(1))+Number(String(t.match(/\:\d*/i)).slice(1))]=clause}}return lrcObj}function scrollLyric(time){if(""===rem.lyric)return!1;if(time=parseInt(time),void 0===rem.lyric||void 0===rem.lyric[time])return!1;if(rem.lastLyric==time)return!0;var i=0;for(var k in rem.lyric){if(time==k)break;i++}rem.lastLyric=time,$(".lplaying").removeClass("lplaying"),$(".lrc-item[data-no='"+i+"']").addClass("lplaying");var scroll=$(".music-info").children().height()*i-$(".music-info").height()/5;$(".music-info").stop().animate({scrollTop:scroll},500)}